app:
  applicationId: "2d2a98f9-63e8-4559-8526-3e2cd80f750d"
  host: "http://localhost:8080"
  env: "DEVELOPMENT"
hawk:
  spider:
    base: true
    maxDurationMinutes: 5
    startupTimeoutMinutes: 5
  scan:
    concurrentRequests: 20
    throttlePassiveBacklog: 10000

auth:
  loggedInIndicator: "Logout"
  loginPath: "/login.php"
  loginPayload:
    username: "admin"
    password: "password"
  loginMethod: FORM

import glob

# === DAST: StackHawk ===
try:
    # Try finding any JSON file generated by StackHawk
    json_paths = glob.glob("**/stackhawk-report.json", recursive=True)

    if not json_paths:
        raise FileNotFoundError("StackHawk report not found in project.")

    report_path = json_paths[0]
    with open(report_path, "r") as f:
        hawk_data = json.load(f)

    combined_report = []

    for finding in hawk_data.get("findings", []):
        cve_ids = finding.get("cve", [])
        if cve_ids:
            title = f"üõ°Ô∏è StackHawk CVE: {', '.join(cve_ids)}"
            body = (
                f"**ID**: {finding['id']}\n"
                f"**Severity**: {finding['severity']}\n"
                f"**Path**: {finding.get('path', 'N/A')}\n"
                f"**CVE Tags**: {', '.join(cve_ids)}"
            )
            create_github_issue(title, body)
            combined_report.append(f"### {title}\n{body}\n")

    if combined_report:
        with open("reports/stackhawk_cve_report.md", "w") as f:
            f.write("# üõ°Ô∏è StackHawk CVE Report\n\n" + "\n".join(combined_report))

except Exception as e:
    print("‚ö†Ô∏è Failed to process StackHawk report:", e)
